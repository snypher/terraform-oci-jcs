module "compartments" {
  source       = "./compartments"
  tenancy_ocid = "${var.tenancy_ocid}"
  app_tag      = "${var.app_tag}"
  environment  = "${var.environment}"
}

module "iam" {
  source       = "./iam"
  tenancy_ocid = "${var.tenancy_ocid}"
  app_tag      = "${var.app_tag}"
  environment  = "${var.environment}"
  env_compartment_ocid = "${module.compartments.cpt_env_id}"
  env_compartment_name = "${module.compartments.cpt_env_name}"
  network_compartment_ocid = "${module.compartments.cpt_network_id}"
  network_compartment_name = "${module.compartments.cpt_network_name}"
  database_compartment_ocid = "${module.compartments.cpt_database_id}"
  database_compartment_name = "${module.compartments.cpt_database_name}"
  admin_compartment_ocid = "${module.compartments.cpt_admin_id}"
  admin_compartment_name = "${module.compartments.cpt_admin_name}"
  application_compartment_ocid = "${module.compartments.cpt_application_id}"
  application_compartment_name = "${module.compartments.cpt_application_name}"
  shared_compartment_ocid = "${module.compartments.cpt_shared_id}"
  shared_compartment_name = "${module.compartments.cpt_shared_name}"
}

module "network" {
  source            = "./network"
  tenancy_ocid      = "${var.tenancy_ocid}"
  compartment_ocid  = "${module.compartments.cpt_network_id}"
  app_tag           = "${var.app_tag}"
  environment       = "${var.environment}"
  vcn_cidr          = "${var.vcn_cidr}"
  subnet_data_cidr  = "${var.subnet_data_cidr}"
  subnet_data_private  = "${var.subnet_data_private}"
  subnet_data_dnslabel = "${var.subnet_data_dnslabel}"
  subnet_app_cidr   = "${var.subnet_app_cidr}"
  subnet_app_private   = "${var.subnet_app_private}"
  subnet_app_dnslabel = "${var.subnet_app_dnslabel}"
  subnet_lbaas_cidr   = "${var.subnet_lbaas_cidr}"
  subnet_lbaas_private   = "${var.subnet_lbaas_private}"
  subnet_lbaas_dnslabel = "${var.subnet_lbaas_dnslabel}"
  subnet_admin_cidr   = "${var.subnet_admin_cidr}"
  subnet_admin_private   = "${var.subnet_admin_private}"
  subnet_admin_dnslabel = "${var.subnet_admin_dnslabel}"
  dhcp_options_server_type = "${var.dhcp_options_server_type}"
  dhcp_options_domain_names = "${var.environment}.${var.dhcp_options_domain_names}"
  anywhere_cidr = "${var.anywhere_cidr}"
  oracle_service_label = "${var.oracle_service_label}"
  oracle_service_ocid = "${var.oracle_service_ocid}"
  default_destination_type = "${var.default_destination_type}"
  default_source_type = "${var.default_source_type}"
  service_destination_type = "${var.service_destination_type}"
  egress_stateless = "${var.egress_stateless}"
  ingress_stateless = "${var.ingress_stateless}"
  tcp_protocol = "${var.tcp_protocol}"
  icmp_protocol = "${var.icmp_protocol}"
  udp_protocol = "${var.udp_protocol}"
  all_protocol = "${var.all_protocol}"
  icmp_type = "${var.icmp_type}"
  icmp_code = "${var.icmp_code}"
  oracle_service_port = "${var.oracle_service_port}"
  database_port = "${var.database_port}"
  ssh_port = "${var.ssh_port}"
  http_port = "${var.http_port}"
  https_port = "${var.https_port}"
}

module "database" {
  source            = "./database"
  tenancy_ocid      = "${var.tenancy_ocid}"
  compartment_ocid  = "${module.compartments.cpt_database_id}"
  app_tag           = "${var.app_tag}"
  environment       = "${var.environment}"
  ad_list           = "${data.template_file.ad_names.*.rendered}"
  db_system_availability_domain = "${var.db_system_availability_domain}"
  db_system_database_edition = "${var.db_system_database_edition}"
  db_system_db_version = "${var.db_system_db_version}"
  db_system_admin_password = "${var.db_system_admin_password}"
  db_system_source = "${var.db_system_source}"
  db_system_character_set = "${var.db_system_character_set}"
  db_system_ncharacter_set = "${var.db_system_ncharacter_set}"
  db_system_auto_backup_enabled = "${var.db_system_auto_backup_enabled}"
  db_system_recovery_window_in_days = "${var.db_system_recovery_window_in_days}"
  db_system_db_name = "${var.db_system_db_name}"
  db_system_pdb_name = "${var.db_system_pdb_name}"
  db_system_db_workload = "${var.db_system_db_workload}"
  db_system_subnet_id = "${module.network.data_subnet_id}"
  db_system_hostname_prefix = "${var.db_system_hostname_prefix}"
  db_system_hostname = "${var.db_system_hostname_prefix}-${var.environment}-${var.app_tag}"
  db_system_cluster_name_prefix = "${var.db_system_cluster_name_prefix}"
  db_system_cluster_name = "${var.db_system_cluster_name_prefix}-${var.environment}-${var.app_tag}"
  db_system_shape = "${var.db_system_shape}"
  db_system_ssh_public_keys = "${var.db_system_ssh_public_keys}"
  db_system_cpu_core_count = "${var.db_system_cpu_core_count}"
  db_system_node_count = "${var.db_system_node_count}"
  db_system_data_storage_percentage = "${var.db_system_data_storage_percentage}"
  db_system_data_storage_size_in_gb = "${var.db_system_data_storage_size_in_gb}"
  db_system_disk_redundancy = "${var.db_system_disk_redundancy}"
  db_system_license_model = "${var.db_system_license_model}"
}

